<!DOCTYPE html><html class="theme-next mist" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/blog/lib/pace/pace.min.js?v=1.0.2"></script><link href="/blog/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Roboto Slab:300,300italic,400,400italic,700,700italicLobster Two:300,300italic,400,400italic,700,700italicSource Code Pro:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/blog/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/blog/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/blog/images/favicon.ico?v=5.1.4" color="#222"><meta name="keywords" content="前端, 分享, 个人博客"><link rel="alternate" href="/blog/atom.xml" title="琥珀丶川" type="application/atom+xml"><meta name="description" content="🎉 react 移动端开发脚手架，技术栈 react + antd-moblie + typescript + react-router + redux"><meta name="keywords" content="前端 JavaScript 个人博客 分享 react vue"><meta property="og:type" content="article"><meta property="og:title" content="react-cli"><meta property="og:url" content="https://blog.9cnext.com/blog/react-cli/index.html"><meta property="og:site_name" content="琥珀丶川"><meta property="og:description" content="🎉 react 移动端开发脚手架，技术栈 react + antd-moblie + typescript + react-router + redux"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2024-06-28T08:34:43.341Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="react-cli"><meta name="twitter:description" content="🎉 react 移动端开发脚手架，技术栈 react + antd-moblie + typescript + react-router + redux"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/blog/",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideRightIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://blog.9cnext.com/blog/react-cli/"><title>react-cli | 琥珀丶川</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/Yechuanjie" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64ceaa;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/blog/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">琥珀丶川</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">下雨和撸码更配~</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-friends"><a href="/blog/friends" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br> 友链</a></li><li class="menu-item menu-item-项目集"><a href="//blog.9cnext.com/project_index" rel="section"><i class="menu-item-icon fa fa-fw fa-code"></i><br> 项目集</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.9cnext.com/blog/blog/react-cli/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ye ChuanJie"><meta itemprop="description" content=""><meta itemprop="image" content="/blog/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="琥珀丶川"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">react-cli</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar"></i></span> <span class="post-meta-item-text">发布时间：</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-13T09:44:03+00:00">2020-07-13</time></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <a href="/blog/react-cli/#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论：</span><span class="post-comments-count valine-comment-count" data-xid="/blog/react-cli/" itemprop="commentCount"></span></a></span> <span id="/blog/react-cli/" class="leancloud_visitors" data-flag-title="react-cli"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">浏览：</span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>🎉 <code>react</code> 移动端开发脚手架，技术栈 <code>react</code> + <code>antd-moblie</code> + <code>typescript</code> + <code>react-router</code> + <code>redux</code></p><a id="more"></a><p>该脚手架基于 <a href="https://www.html.cn/create-react-app/" target="_blank" rel="noopener">Create React App</a> 创建，方便快速搭建 react 移动端项目。<a href="https://github.com/Yechuanjie/react-cli" target="_blank" rel="noopener">仓库地址</a> &amp;&amp; <a href="https://blog.9cnext.com/react-cli/index">项目地址（请在移动端查看）</a></p><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a><span id="top">目录</span></h3><p><a href="#ts">✅ TypeScript 开发语言</a></p><p><a href="#redux">✅ redux 状态管理</a></p><p><a href="#router">✅ react-router 路由管理</a></p><p><a href="#axios">✅ axios 封装及接口管理</a></p><p><a href="#mock">✅ 本地 mock server 支持</a></p><p><a href="#proxy">✅ 本地跨域配置</a></p><p><a href="#eslint">✅ esint + prettier 统一开发规范</a></p><p><a href="#webpack">✅ 支持自定义 webpack 配置</a></p><p><a href="#rem">✅ rem 适配方案</a></p><p><a href="#antd">✅ antd-moblie 组件按需加载</a></p><p><a href="#alias">✅ 配置 alias 别名</a></p><p><a href="#analyze">✅ 配置打包分析</a></p><p><a href="#env">✅ 配置多环境变量</a></p><h4 id="✅-TypeScript-开发语言"><a href="#✅-TypeScript-开发语言" class="headerlink" title="✅ TypeScript 开发语言"></a><span id="ts">✅ TypeScript 开发语言</span></h4><p><code>TypeScript</code> 是 <code>JavaScript</code> 类型的超集，它可以编译成纯 <code>JavaScript</code>。它的最大特点就是支持强类型和 <a href="http://es6.ruanyifeng.com/#docs/class" target="_blank" rel="noopener">ES6 Class</a></p><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-redux-状态管理"><a href="#✅-redux-状态管理" class="headerlink" title="✅ redux  状态管理"></a><span id="redux">✅ redux 状态管理</span></h4><p>目录结构</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├─store</span><br><span class="line">│  │ index.ts</span><br><span class="line">│  │</span><br><span class="line">│  ├─actions</span><br><span class="line">│  │   user.ts</span><br><span class="line">│  │</span><br><span class="line">│  └─reducers</span><br><span class="line">│      index.ts</span><br><span class="line">│      user.ts</span><br></pre></td></tr></table></figure><p>拆分 reducer</p><p><code>store/index</code> 中 <code>combineReducers()</code> 方法将多个小的 reducer 组合成一个 rootReducer，而每个小的 reducer 只关心自己负责的 <code>action.type</code></p><p><code>src/index.tsx</code> 中引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;React.StrictMode&gt;</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>React.StrictMode&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; setAppUserInfo &#125; <span class="keyword">from</span> <span class="string">'@/store/actions/user'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> userInfo = useSelector(<span class="function">(<span class="params">state: PageStateProps</span>) =&gt;</span> state.user)</span><br><span class="line">  <span class="keyword">const</span> dispath = useDispatch()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> updateInfo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispath(</span><br><span class="line">      setAppUserInfo(&#123;</span><br><span class="line">        userId: <span class="string">'413'</span>,</span><br><span class="line">        nickName: <span class="string">'developer'</span>,</span><br><span class="line">        sex: <span class="number">1</span></span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"page"</span>&gt;</span><br><span class="line">      &lt;div onClick=&#123;updateInfo&#125;&gt;</span><br><span class="line">        &lt;Logo&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Logo</span>&gt;</span></span></span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div className="welcome"&gt;hello &#123;userInfo.nickName&#125;!&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-react-router-路由管理"><a href="#✅-react-router-路由管理" class="headerlink" title=" ✅ react-router 路由管理"></a> <span id="router">✅ react-router 路由管理</span></h4><p>本项目采用 <code>history</code> 模式，如需使用 <code>hash</code> 模式，请使用 <code>HashRouter</code> 替换 <code>BrowserRouter</code></p><p><code>basename</code> 属性可以根据项目路径来修改，例如本项目地址为：<a href="http://blog.9cnext.com/react-cli">http://blog.9cnext.com/react-cli</a>，则 <code>basename=&quot;/react-cli&quot;</code>，若不需要子路径，则默认<code>basename = &#39;/&#39;</code></p><p><code>src/router/routes.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; lazy &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">const</span> Index = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/index'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routes: RouteConfig[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/index'</span>,</span><br><span class="line">    component: Index,</span><br><span class="line">    exact: <span class="literal">true</span>,</span><br><span class="line">    routes: []</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>src/router/index.tsx</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Route, Redirect, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">'./routes'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RouterView = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;BrowserRouter basename=<span class="string">"/react-cli"</span>&gt;</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;div&gt;加载中&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">        &#123;routes.map(route =&gt; (</span></span><br><span class="line"><span class="regexp">          &lt;Route key=&#123;route.path&#125; path=&#123;route.path&#125; component=&#123;route.component&#125; exact=&#123;route.exact&#125;&gt;&lt;/</span>Route&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">        &lt;Redirect to=<span class="string">"/index"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Redirect</span>&gt;</span></span></span><br><span class="line">      &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Suspense&gt;</span><br><span class="line">  &lt;<span class="regexp">/BrowserRouter&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp">export default RouterView</span></span><br></pre></td></tr></table></figure><p>使用 <code>lazy</code> + <code>Suspense</code> 的方式实现路由懒加载以及组件异步加载</p><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-axios-封装及接口管理"><a href="#✅-axios-封装及接口管理" class="headerlink" title="✅ axios 封装及接口管理"></a><span id="axios">✅ axios 封装及接口管理</span></h4><p>将 <code>axios</code> 请求进行二次封装，统一请求方式、实现公共参数配置、实现统一的错误拦截处理，并返回与后端统一的 <code>Promise&lt;ResponseType&gt;</code> 对象</p><p><code>request</code> 封装 ，<code>src/api/request.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; AxiosRequestConfig, Method &#125; <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> envConfig <span class="keyword">from</span> <span class="string">'@/config'</span></span><br><span class="line"><span class="comment">// 接口返回类型 (根据后端返回的格式定义)</span></span><br><span class="line"><span class="keyword">interface</span> ResponseType &#123;</span><br><span class="line">  data: <span class="built_in">any</span></span><br><span class="line">  msg: <span class="built_in">string</span></span><br><span class="line">  code: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url: <span class="built_in">string</span>, method: Method, data?: &#123;&#125;, loading?: <span class="built_in">boolean</span></span>): <span class="title">Promise</span>&lt;<span class="title">ResponseType</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 请求公共参数配置</span></span><br><span class="line">  <span class="keyword">const</span> publicParams = &#123;</span><br><span class="line">    env: envConfig.ENV_TYPE,</span><br><span class="line">    mockType: <span class="number">1</span>,</span><br><span class="line">    source: <span class="string">'h5'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 合并公共参数</span></span><br><span class="line">  data = <span class="built_in">Object</span>.assign(&#123;&#125;, data, publicParams)</span><br><span class="line">  <span class="keyword">const</span> options: AxiosRequestConfig = &#123;</span><br><span class="line">    url,</span><br><span class="line">    method,</span><br><span class="line">    params: method.toUpperCase() === <span class="string">'GET'</span> || method.toUpperCase() === <span class="string">'DELETE'</span> ? data : <span class="literal">null</span>,</span><br><span class="line">    data: method.toUpperCase() === <span class="string">'POST'</span> || method.toUpperCase() === <span class="string">'PUT'</span> ? data : <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> AxiosInstance = initAxios(loading)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    AxiosInstance(options)</span><br><span class="line">      .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = res.data <span class="keyword">as</span> ResponseType</span><br><span class="line">        <span class="comment">// 这里可以添加和后台的 status 约定</span></span><br><span class="line">        <span class="comment">// if (data.code !== 200) &#123;</span></span><br><span class="line">        <span class="comment">//   Toast.info(data.msg)</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        reject(err)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接口管理 <code>src/api/index.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'./request'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getList = <span class="function">(<span class="params">params: &#123; <span class="keyword">type</span>: <span class="built_in">number</span> &#125;</span>) =&gt;</span> request(<span class="string">'/api/getInfo'</span>, <span class="string">'GET'</span>, &#123; ...params &#125;, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>使用封装的<code>request</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> API <span class="keyword">from</span> <span class="string">'@/api/index'</span></span><br><span class="line"><span class="keyword">const</span> updateInfo = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// get 请求</span></span><br><span class="line">  <span class="keyword">const</span> list = <span class="keyword">await</span> API.getList(&#123; <span class="keyword">type</span>: <span class="number">1</span> &#125;)</span><br><span class="line">  <span class="built_in">console</span>.info(list) <span class="comment">// 请求结果就是封装后的 Promise&lt;ResponseType&gt; 类型</span></span><br><span class="line">  <span class="comment">// 对于接口返回的数据格式，可以统一在global.d.ts里定义interface，假设你已经定义了 interface ListDetail, 然后如下使用</span></span><br><span class="line">  <span class="keyword">const</span> data = list.data <span class="keyword">as</span> ListDetail <span class="comment">// 断言data类型，后续就可以直接使用定义好的数据结构</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-本地-mock-server-支持"><a href="#✅-本地-mock-server-支持" class="headerlink" title="✅ 本地 mock server 支持"></a><span id="mock">✅ 本地 mock server 支持</span></h4><p><code>src/mock</code> 实现了本地 <code>mock server</code> 开发。</p><p>注意： <code>nodejs</code> 环境下默认不支持 <code>esModules</code>，将<code>src/mock</code>下的文件，修改为<code>.mjs</code>后缀，同时在<code>package.json</code> 的<code>scripts</code>中新增<code>experimental-modules</code>命令使其可以使用<code>esModules</code></p><p><code>package.json</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scripts: &#123;</span><br><span class="line">  "mock": "node --experimental-modules src/mock/server.mjs"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本项目使用 <code>express</code> 作为服务器开发</p><p><code>src/mock/server.mjs</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">'express'</span></span><br><span class="line"><span class="keyword">import</span> mockData <span class="keyword">from</span> <span class="string">'./mock.mjs'</span></span><br><span class="line"><span class="keyword">import</span> bodyParser <span class="keyword">from</span> <span class="string">'body-parser'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"><span class="comment">// body-parser 解析json格式数据</span></span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line">router.use(<span class="string">'/'</span>, mockData)</span><br><span class="line">app.use(<span class="string">'/api'</span>, router)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3001</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Example app listening on port 3001!'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>mock 数据根据需求在<code>src/mock/mock.mjs</code>中自定义修改，更多 mock 使用方式可以查看<a href="%5Bhttp://mockjs.com/examples.html%5D(http://mockjs.com/examples.html">mock 官方示例</a>&gt;)。</p><p><code>src/mock/mock.mjs</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Mock <span class="keyword">from</span> <span class="string">'mockjs'</span></span><br><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">'express'</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"><span class="comment">// get类型接口  /api/getInfo 获取列表</span></span><br><span class="line">router.get(<span class="string">'/getInfo'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.info(req.query.type)</span><br><span class="line">  <span class="keyword">const</span> data = Mock.mock(&#123;</span><br><span class="line">    <span class="string">'list|1-8'</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">'name|1'</span>: [<span class="string">'John'</span>, <span class="string">'Jessen'</span>, <span class="string">'Mark'</span>],</span><br><span class="line">        <span class="string">'desc|1'</span>: [<span class="string">'Hello'</span>, <span class="string">'React-cli'</span>, <span class="string">'Try it!'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">    data,</span><br><span class="line">    code: <span class="number">200</span>,</span><br><span class="line">    msg: <span class="string">''</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>开启本地 <code>mock</code> 服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn mock</span><br></pre></td></tr></table></figure><p>本地开启 <code>mock</code> 服务后，所有本地 <code>api</code> 请求都会导致<strong>跨域问题</strong>，请参考<a href="#proxy">✅ 本地跨域配置</a></p><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-本地跨域配置"><a href="#✅-本地跨域配置" class="headerlink" title="✅ 本地跨域配置"></a><span id="proxy">✅ 本地跨域配置</span></h4><p>为解决本地接口请求跨域，需要使用到 <code>http-proxy-middleware</code> 中间件。在 src 根目录下创建<code>setupProxy.js</code>文件，注意这里只能使用 <code>.js</code> 后缀，因为该中间件默认读取的是 <code>js</code> 文件</p><p><code>src/setupProxy.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">'http-proxy-middleware'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">app</span>) </span>&#123;</span><br><span class="line">  app.use(</span><br><span class="line">    createProxyMiddleware(<span class="string">'/api'</span>, &#123;</span><br><span class="line">      <span class="comment">// 代理服务器地址</span></span><br><span class="line">      target: <span class="string">'http://localhost:3001'</span>,</span><br><span class="line">      secure: <span class="literal">false</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123;</span><br><span class="line">        <span class="string">'^/api'</span>: <span class="string">'/api'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样一来，就可以愉快的在本地请求自己的<code>mock</code>数据啦！</p><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-eslint-prettier-统一开发规范"><a href="#✅-eslint-prettier-统一开发规范" class="headerlink" title="✅ eslint + prettier 统一开发规范"></a><span id="eslint">✅ eslint + prettier 统一开发规范</span></h4><p>在<code>package.json</code>文件中编写自定义<code>eslint</code>规则</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"eslintConfig"</span>: &#123;</span><br><span class="line">    <span class="attr">"extends"</span>: <span class="string">"react-app"</span>,</span><br><span class="line">    <span class="attr">"rules"</span>: &#123;</span><br><span class="line">      <span class="attr">"import/no-commonjs"</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写统一的<code>prettier</code>规范文件 <code>.prettierrc</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"singleQuote"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"semi"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"printWidth"</span>: <span class="number">120</span>,</span><br><span class="line">  <span class="attr">"arrowParens"</span>: <span class="string">"avoid"</span>,</span><br><span class="line">  <span class="attr">"bracketSpacing"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"jsxBracketSameLine"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"trailingComma"</span>: <span class="string">"none"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-支持自定义-webpack-配置"><a href="#✅-支持自定义-webpack-配置" class="headerlink" title="✅ 支持自定义 webpack 配置"></a><span id="webpack">✅ 支持自定义 webpack 配置</span></h4><p>通过 <code>customize-cra</code> 暴露 <code>webpack</code> 配置的<code>config-overrides.js</code>文件，使我们可以不用 <code>eject</code> 的方式就能在这里覆盖重写 <code>webpack</code> 配置，目前已支持几十种相关配置自定义，具体可查看<a href="[https://github.com/arackaf/customize-cra/blob/HEAD/api.md](https://github.com/arackaf/customize-cra/blob/HEAD/api.md">customize-cra api docs</a>&gt;)。</p><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-rem-适配方案"><a href="#✅-rem-适配方案" class="headerlink" title="✅ rem 适配方案 "></a><span id="rem">✅ rem 适配方案</span></h4><p>项目已经配置好 <code>rem</code> 适配，下面仅做介绍：</p><p><code>antd-mobile</code> 中的样式默认使用<code>px</code>作为单位，如果需要使用<code>rem</code>单位，推荐使用<code>postcss-px2rem</code> 搭配 <code>src/utils/rem.ts</code>一起使用。其中 <code>src/utils/rem.ts</code> 实现了一个极简的 rem 库。</p><p><code>postcss-px2rem</code> 插件使用</p><ul><li><p>假如设计图给的宽度是 750，remUnit 设置为 75，这样我们写样式时，可以直接按照设计图标注的宽高来 1:1 还原开发。</p></li><li><p>PS: 如果引用了某些没有兼容 px2rem 第三方 UI 框架，有的 1rem = 100px（antd-mobile）， 有的 1rem = 75px</p></li><li><p>需要将 remUnit 的值设置为像素对应的一半（antd-mobile 即 50），即可以 1:1 还原组件，否则会样式会有变化，例如按钮会变小。</p></li></ul><p><code>config-overrides.js</code>，使用<code>addPostcssPlugins</code>设置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override, addPostcssPlugins &#125; = <span class="built_in">require</span>(<span class="string">'customize-cra'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = override(addPostcssPlugins([<span class="built_in">require</span>(<span class="string">'postcss-px2rem'</span>)(&#123; <span class="attr">remUnit</span>: <span class="number">50</span> &#125;)]))</span><br></pre></td></tr></table></figure><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-antd-moblie-组件按需加载"><a href="#✅-antd-moblie-组件按需加载" class="headerlink" title="✅ antd-moblie 组件按需加载"></a><span id="antd">✅ antd-moblie 组件按需加载</span></h4><p><a href="https://github.com/ant-design/babel-plugin-import" target="_blank" rel="noopener">babel-plugin-import</a> 是一款 <code>babel</code> 插件，它会在编译过程中将 <code>import</code> 的写法自动转换为按需引入的方式。</p><p>安装插件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add babel-plugin-import</span><br></pre></td></tr></table></figure><p><code>config-overrides.js</code>，使用<code>fixBabelImports</code>设置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override, fixBabelImports &#125; = <span class="built_in">require</span>(<span class="string">'customize-cra'</span>)</span><br><span class="line"><span class="comment">// 引用 antd 后设置按需引入后，在打包的时候会生成很多 .map 文件</span></span><br><span class="line">process.env.GENERATE_SOURCEMAP = <span class="string">'false'</span></span><br><span class="line"><span class="built_in">module</span>.exports = override(</span><br><span class="line">  <span class="comment">/* 按需引入antd-mobile */</span></span><br><span class="line">  fixBabelImports(<span class="string">'import'</span>, &#123;</span><br><span class="line">    libraryName: <span class="string">'antd-mobile'</span>,</span><br><span class="line">    style: <span class="string">'css'</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-配置-alias-别名"><a href="#✅-配置-alias-别名" class="headerlink" title="✅ 配置 alias 别名"></a><span id="alias">✅ 配置 alias 别名</span></h4><p><code>config-overrides.js</code>，使用<code>addWebpackAlias</code>设置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override, addWebpackAlias &#125; = <span class="built_in">require</span>(<span class="string">'customize-cra'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">dir</span> =&gt;</span> path.join(__dirname, dir)</span><br><span class="line"><span class="built_in">module</span>.exports = override(</span><br><span class="line">  addWebpackAlias(&#123;</span><br><span class="line">    <span class="string">'@/'</span>: resolve(<span class="string">'src'</span>),</span><br><span class="line">    <span class="string">'@/pages'</span>: resolve(<span class="string">'./src/pages'</span>),</span><br><span class="line">    <span class="string">'@/api'</span>: resolve(<span class="string">'./src/api'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="tsconfig-json"><a href="#tsconfig-json" class="headerlink" title="tsconfig.json"></a>tsconfig.json</h4><p>根目录的 <code>tsconfig.json</code> 文件中也需要设置别名的支持，否则 ts 会提示无法识别别名</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"baseUrl"</span>: <span class="string">"src"</span>,</span><br><span class="line">    <span class="attr">"paths"</span>: &#123;</span><br><span class="line">      <span class="attr">"@/*"</span>: [<span class="string">"*"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Tips:</code> 推荐使用 <code>vscode</code> 开发，安装 <code>path-intellisense</code>插件, 并在 <code>setting.json</code> 中设置别名映射，就能在使用别名时提示文件路径</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"path-intellisense.mappings": &#123;</span><br><span class="line">  "@": "\$&#123;workspaceRoot&#125;/src"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-配置打包分析"><a href="#✅-配置打包分析" class="headerlink" title="✅ 配置打包分析"></a><span id="analyze">✅ 配置打包分析</span></h4><p>webpack-bundle-analyzer 是一款分析代码大小的插件</p><p>首先安装它：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack-bundle-analyzer</span><br></pre></td></tr></table></figure><p>在 <code>config-overrides.js</code> 中，使用 <code>addWebpackPlugin</code> 设置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BundleAnalyzerPlugin &#125; = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; override, addWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'customize-cra'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> analyze = process.env.REACT_APP_ENV === <span class="string">'development'</span> <span class="comment">//是否分析打包数据</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = override(</span><br><span class="line">  analyze</span><br><span class="line">    ? addWebpackPlugin(</span><br><span class="line">        <span class="keyword">new</span> BundleAnalyzerPlugin(&#123;</span><br><span class="line">          analyzerMode: <span class="string">'static'</span> <span class="comment">//输出静态报告文件report.html，而不是启动一个web服务</span></span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">    : <span class="literal">undefined</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><a href="#top">▲ 回顶部</a></p><h4 id="✅-配置多环境变量"><a href="#✅-配置多环境变量" class="headerlink" title="✅ 配置多环境变量 "></a><span id="env">✅ 配置多环境变量</span></h4><p><code>package.json</code> 里的 <code>scripts</code> 配置 <code>build:dev</code> <code>build:sta</code> <code>build:pro</code>来执行不同环境</p><ul><li><code>yarn start</code> 启动本地 , 默认执行 <code>development</code></li><li><code>yarn build:dev</code> 打包测试环境 , 执行 <code>development</code></li><li><code>yarn build:sta</code> 打包预发布环境 , 执行 <code>staging</code></li><li><code>yarn build:pro</code> 打包正式环境 , 执行 <code>production</code></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "start": "react-app-rewired start",</span><br><span class="line">  "build:dev": "dotenv -e .env.development react-app-rewired build",</span><br><span class="line">  "build:sta": "dotenv -e .env.staging react-app-rewired build",</span><br><span class="line">  "build:pro": "dotenv -e .env.production react-app-rewired build"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="配置详情"><a href="#配置详情" class="headerlink" title="配置详情"></a>配置详情</h5><p>在 <strong>根目录</strong> 下创建不同的环境变量文件，如 <code>.env.development</code> ，<code>.env.staging</code>， <code>.env.production</code>，就如你所看到的 <code>scripts</code> ，通过 <code>dotenv</code> 可以指定不同的环境变量文件。</p><p>在代码中可以通过 <code>process.env.REACT_APP_ENV</code> 访问所在的环境变量。除了 <code>REACT_APP_*</code> 变量之外，在你的应用代码中始终可用的还有两个特殊的变量<code>NODE_ENV</code> 和<code>BASE_URL</code></p><ul><li><strong>.env.development</strong></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 测试环境</span><br><span class="line"># must start with REACT_APP_</span><br><span class="line">REACT_APP_ENV = <span class="string">'development'</span></span><br></pre></td></tr></table></figure><ul><li><strong>.env.staging</strong></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 预发布环境</span><br><span class="line"># must start with REACT_APP_</span><br><span class="line">REACT_APP_ENV = <span class="string">'staging'</span></span><br></pre></td></tr></table></figure><ul><li><strong>.env.production</strong></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 正式环境</span><br><span class="line"># must start with REACT_APP_</span><br><span class="line">REACT_APP_ENV = <span class="string">'production'</span></span><br></pre></td></tr></table></figure><p>这里我们并没有定义全部环境变量，只定义了基础的环境类型 REACT_APP_ENV <code>development</code>，<code>staging</code>， <code>production</code> 。变量我们统一在 <code>src/config/env.*.ts</code> 里进行管理</p><p><code>question:</code> 为什么要在 <code>config</code> 中新建三个文件，而不是直接写在环境变量文件里呢？</p><ul><li><p><strong>修改变量方便，无需重新启动项目</strong></p></li><li><p><strong>引入方式更符合模块化标准</strong></p></li></ul><p>config/index.ts</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据build命令指定的环境，引入不同配置</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./env.'</span> + process.env.REACT_APP_ENV)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> config.default</span><br></pre></td></tr></table></figure><p>每种环境单独去配置公共变量，以测试环境配置为例</p><p><code>config/.env.development.ts</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试环境配置</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ENV_TYPE: <span class="string">'测试环境'</span>,</span><br><span class="line">  BASE_URL: <span class="string">'//test.xxx.com'</span> <span class="comment">// api请求地址</span></span><br><span class="line">  OTHER_GLOBAL_VAR: <span class="string">'xxx'</span> <span class="comment">// 可添加自定义的公共变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据环境变量不同，<code>config</code> 配置就会不同</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'@/config'</span></span><br><span class="line"><span class="built_in">console</span>.info(config)</span><br><span class="line"><span class="comment">// config</span></span><br><span class="line">&#123;</span><br><span class="line">  ENV_TYPE: <span class="string">'测试环境'</span>,</span><br><span class="line">  BASE_URL: <span class="string">'//test.xxx.com'</span></span><br><span class="line">  OTHER_GLOBAL_VAR: <span class="string">'xxx'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="#top">▲ 回顶部</a></p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px;margin-top:50px;margin-bottom:50px">-------------本文结束<i class="fa fa-codepen"></i>感谢您的阅读-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Ye ChuanJie</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://blog.9cnext.com/blog/react-cli/" title="react-cli">https://blog.9cnext.com/blog/react-cli/</a></li><li> <strong>发布时间：</strong> 2020年07月13日 - 09:44</li><li> <strong>最后更新：</strong> 2024年06月28日 - 08:34</li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/blog/lottie/" rel="next" title="使用lottie-web制作高性能动画"><i class="fa fa-chevron-left"></i> 使用lottie-web制作高性能动画</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/blog/images/avatar.png" alt="Ye ChuanJie"><p class="site-author-name" itemprop="name">Ye ChuanJie</p><p class="site-description motion-element" itemprop="description">🌴喝可乐的猫</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/blog/archives/"><span class="site-state-item-count">5</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/blog/categories/index.html"><span class="site-state-item-count">3</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/blog/tags/index.html"><span class="site-state-item-count">6</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/blog/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"> <span class="links-of-author-item"><a href="https://github.com/Yechuanjie" target="_blank" title="GitHub">GitHub</a></span> <span class="links-of-author-item"><a href="https://juejin.im/user/57eb8d41a0bb9f005863369c" target="_blank" title="掘金">掘金</a></span> <span class="links-of-author-item"><a href="mailto:yechuanjie.me@gmail.com" target="_blank" title="邮箱">邮箱</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#目录"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-TypeScript-开发语言"><span class="nav-number">1.1.</span> <span class="nav-text">✅ TypeScript 开发语言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-redux-状态管理"><span class="nav-number">1.2.</span> <span class="nav-text">✅ redux 状态管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-react-router-路由管理"><span class="nav-number">1.3.</span> <span class="nav-text">✅ react-router 路由管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-axios-封装及接口管理"><span class="nav-number">1.4.</span> <span class="nav-text">✅ axios 封装及接口管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-本地-mock-server-支持"><span class="nav-number">1.5.</span> <span class="nav-text">✅ 本地 mock server 支持</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-本地跨域配置"><span class="nav-number">1.6.</span> <span class="nav-text">✅ 本地跨域配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-eslint-prettier-统一开发规范"><span class="nav-number">1.7.</span> <span class="nav-text">✅ eslint + prettier 统一开发规范</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-支持自定义-webpack-配置"><span class="nav-number">1.8.</span> <span class="nav-text">✅ 支持自定义 webpack 配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-rem-适配方案"><span class="nav-number">1.9.</span> <span class="nav-text">✅ rem 适配方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-antd-moblie-组件按需加载"><span class="nav-number">1.10.</span> <span class="nav-text">✅ antd-moblie 组件按需加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-配置-alias-别名"><span class="nav-number">1.11.</span> <span class="nav-text">✅ 配置 alias 别名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tsconfig-json"><span class="nav-number">1.12.</span> <span class="nav-text">tsconfig.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-配置打包分析"><span class="nav-number">1.13.</span> <span class="nav-text">✅ 配置打包分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#✅-配置多环境变量"><span class="nav-number">1.14.</span> <span class="nav-text">✅ 配置多环境变量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#配置详情"><span class="nav-number">1.14.1.</span> <span class="nav-text">配置详情</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 - <span itemprop="copyrightYear">2024</span> <span>|</span> <span class="author" itemprop="copyrightHolder">Ye ChuanJie</span></div><div class="theme-info"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script type="text/javascript" src="/blog/js/src/runtime.js?v=5.1.4"></script></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> <span class="busuanzi-value" id="busuanzi_value_site_uv">正在载入uv...</span></span><span class="site-pv"><i class="fa fa-eye"></i> <span class="busuanzi-value" id="busuanzi_value_site_pv">正在载入pv...</span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/blog/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.4"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'RRpsWunBomCOwQTN2luQ6aPv-gzGzoHsz',
        appKey: '44TCEwTmFIJGDuT5vf0NLLCi',
        placeholder: '输入邮箱才能正常回复哦~',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/blog/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("RRpsWunBomCOwQTN2luQ6aPv-gzGzoHsz","44TCEwTmFIJGDuT5vf0NLLCi")</script><script>function showTime(e){var t=new AV.Query(e),c=[],u=$(".leancloud_visitors");u.each(function(){c.push($(this).attr("id").trim())}),t.containedIn("url",c),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var n=0;n<e.length;n++){var o=e[n],i=o.get("url"),s=o.get("time"),r=document.getElementById(i);$(r).find(t).text(s)}for(n=0;n<c.length;n++){i=c[n],r=document.getElementById(i);var l=$(r).find(t);""==l.text()&&l.text(0)}}else u.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(i){var e=$(".leancloud_visitors"),s=e.attr("id").trim(),r=e.attr("data-flag-title").trim(),t=new AV.Query(i);t.equalTo("url",s),t.find({success:function(e){if(0<e.length){var t=e[0];t.fetchWhenSave(!0),t.increment("time"),t.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var n=new i,o=new AV.ACL;o.setPublicReadAccess(!0),o.setPublicWriteAccess(!0),n.setACL(o),n.set("title",r),n.set("url",s),n.set("time",1),n.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):1<$(".post-title-link").length&&showTime(e)})</script><script src="/blog/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!0,log:!1,model:{scale:1,hHeadPos:.5,vHeadPos:.618,jsonPath:"/blog/live2dw/assets/assets/koharu.model.json"},display:{superSample:2,width:50,height:100,position:"left",hOffset:30,vOffset:-20},mobile:{show:!0,scale:1},react:{opacityDefault:.7,opacityOnHover:.2}})</script><script type="text/javascript" src="/blog/js/src/crash_cheat.js?v=5.1.4"></script></body></html>